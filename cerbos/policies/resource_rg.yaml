# Review Group (RG) Resource Policy
# Defines permissions for review group-level operations
---
apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: "default"
  resource: "rg"
  importDerivedRoles:
    - ifla_standards_roles
  rules:
    # System administrators can do everything
    - actions: ["*"]
      effect: EFFECT_ALLOW
      roles: ["system-admin", "ifla-admin"]
      
    # Review group administrators can manage their review group
    - actions: ["view", "edit", "manage", "delete", "create_site", "manage_users"]
      effect: EFFECT_ALLOW
      derivedRoles: ["rg_admin"]
      
    # Review group editors can edit content across the review group
    - actions: ["view", "edit", "create", "update"]
      effect: EFFECT_ALLOW
      derivedRoles: ["rg_editor"]
      
    # Review group reviewers can review and approve content
    - actions: ["view", "review", "approve", "reject", "comment"]
      effect: EFFECT_ALLOW
      derivedRoles: ["rg_reviewer"]
      
    # Review group translators can translate content
    - actions: ["view", "translate", "edit_translation"]
      effect: EFFECT_ALLOW
      derivedRoles: ["rg_translator"]
      
    # Review group contributors can propose changes
    - actions: ["view", "contribute", "propose", "comment"]
      effect: EFFECT_ALLOW
      derivedRoles: ["rg_contributor"]
      
    # Anyone can view public review groups
    - actions: ["view"]
      effect: EFFECT_ALLOW
      roles: ["*"]
      condition:
        match:
          expr: R.attr.visibility == "public"
          
  schemas:
    principalSchema:
      ref: cerbos:///principal.json
    resourceSchema:
      ref: cerbos:///rg.json