# Vocabulary Site Scaffolding Guide

This guide explains the enhanced vocabulary site scaffolding system that generates complete site structures for IFLA standards, including all necessary files referenced by the navigation sidebar.

## Overview

The vocabulary site scaffolding system creates a complete Docusaurus site structure for IFLA standards, including:

1. **Landing page** - Overview of the standard with statistics and links
2. **Element sets** - Index and individual pages for each element set
3. **Vocabularies** - Index and individual pages for each vocabulary
4. **Documentation** - Standard documentation pages (introduction, examples, about)
5. **Tools & Resources** - Pages for search, cross-set browser, and other tools

The system ensures that all files referenced in the navigation sidebar exist, preventing "document ids do not exist" build errors.

## Key Components

### 1. Page Template Generator

The `PageTemplateGenerator` class in `scripts/page-template-generator.ts` generates all necessary page templates:

```typescript
class PageTemplateGenerator {
  // Main method to generate all templates for a site
  async generateSitePageTemplates(namespace: string, config: SiteConfiguration): Promise<void>;
  
  // Core page generation methods
  private generateLandingPage(config: SiteConfiguration): PageTemplate;
  private generateElementSetsIndexPage(config: SiteConfiguration): PageTemplate;
  private generateVocabulariesIndexPage(config: SiteConfiguration): PageTemplate;
  
  // Enhanced methods for individual pages
  private generateIndividualElementSetPages(config: SiteConfiguration): PageTemplate[];
  private generateIndividualVocabularyPages(config: SiteConfiguration): PageTemplate[];
  private generateDocumentationPages(config: SiteConfiguration): PageTemplate[];
  private generateToolsPages(config: SiteConfiguration): PageTemplate[];
}
```

### 2. File Structure Validator

The file structure validator in `scripts/validate-sidebar-references.ts` ensures that all files referenced in the sidebar exist:

```typescript
// Validate sidebar references
async function validateSidebarReferences(siteDir: string, sidebarPath: string): Promise<void>;

// Extract references from sidebar
async function extractSidebarReferencesFromFile(sidebarPath: string): Promise<DocReference[]>;

// Expand autogenerated references
async function expandAutogeneratedReferences(siteDir: string, references: DocReference[]): Promise<DocReference[]>;

// Check if files exist
async function checkFilesExist(siteDir: string, references: DocReference[]): Promise<MissingFileReport[]>;

// Generate report of missing files
function generateMissingFilesReport(missingFiles: MissingFileReport[]): string;
```

## Generated File Structure

The system generates the following file structure for each standard:

```
standards/
  {namespace}/
    docs/
      index.mdx                     # Landing page
      introduction.mdx              # Introduction to the standard
      examples.mdx                  # Usage examples
      about.mdx                     # About the standard
      assessment.mdx                # Assessment guidelines (if needed)
      glossary.mdx                  # Terminology glossary (if needed)
      search.mdx                    # Search functionality (hierarchical navigation)
      cross-set-browser.mdx         # Cross-set browser (hierarchical navigation)
      field-guide.mdx               # Field guide (hierarchical navigation)
      elements/
        index.mdx                   # Element sets index page
        {element-set-id}/
          index.mdx                 # Element set page
          {category}/               # Subcategories (if needed)
            index.mdx               # Category index page
      vocabularies/
        index.mdx                   # Vocabularies index page
        {vocabulary-id}.mdx         # Individual vocabulary pages
        {category}/                 # Categories (if needed)
          index.mdx                 # Category index page
          {vocabulary-id}.mdx       # Categorized vocabulary pages
```

## Example Generated Files

### Element Set Page Example

```mdx
---
title: ISBD Manifestation
sidebar_position: 1
---

# ISBD Manifestation

Element set for describing manifestations in the ISBD standard.

This element set contains 156 elements.

## Overview

The ISBD Manifestation element set provides a structured way to describe ISBD resources.

## Elements

Elements will be listed here when imported.

## Languages

This element set is available in the following languages:
- English (en)
- French (fr)
- Spanish (es)
```

### Vocabulary Page Example

```mdx
---
title: Content Forms
sidebar_position: 1
---

# Content Forms

Vocabulary of content forms in the ISBD standard.

This vocabulary contains 12 concepts.

## Concepts

Concepts will be listed here when imported.

## Languages

This vocabulary is available in the following languages:
- English (en)
- French (fr)
```

### Documentation Page Example

```mdx
---
title: Introduction
sidebar_position: 1000
---

# ISBD Introduction

Overview of ISBD principles, scope, and application guidelines.

## Purpose

The ISBD standard provides a framework for ISBD implementation.

## Key Concepts

Key concepts and principles of the ISBD standard.

## How to Use This Documentation

This documentation is organized into sections covering different aspects of the ISBD standard.

*This page is under development.*
```

## Usage

### Generating a New Site

To generate a complete new site with all necessary files:

```bash
# Create a new site with the scaffold script
pnpm tsx scripts/scaffold-site.ts --siteKey=newsite --title="New Standard" --tagline="A new IFLA standard"

# Generate page templates for the site
pnpm tsx scripts/page-template-generator.ts --namespace=newsite
```

### Validating File Structure

To validate that all sidebar references have corresponding files:

```bash
# Validate a specific site
pnpm tsx scripts/validate-sidebar-references.ts standards/isbd

# Validate all sites
for site in standards/*; do
  if [ -d "$site" ]; then
    pnpm tsx scripts/validate-sidebar-references.ts "$site"
  fi
done
```

### Generating Missing Files

To generate only missing files for an existing site:

```bash
# Generate missing files for a specific site
pnpm tsx scripts/page-template-generator.ts --namespace=isbd --missing-only
```

> **Note**: If the `--namespace` option is not working, you may need to apply the fix described in [Vocabulary Site Scaffolding Fix](./vocabulary-site-scaffolding-fix.md).

## Best Practices

1. **Always validate after generation**: Run the validator after generating pages to ensure all references have corresponding files.
2. **Don't overwrite existing files**: The generator skips existing files to preserve custom content.
3. **Follow the ISBD pattern**: Use ISBD as the reference implementation for file structure.
4. **Use hierarchical navigation for complex standards**: For standards with many element sets and vocabularies, use hierarchical navigation.
5. **Include all required documentation pages**: Ensure all standard documentation pages (introduction, examples, about) are included.

## Troubleshooting

### Common Issues

1. **Missing files**: If the validator reports missing files, run the generator with the `--missing-only` flag.
2. **Duplicate files**: If the generator reports duplicate files, check for conflicting file paths.
3. **Sidebar references**: If the sidebar references files that don't exist, update the sidebar or generate the missing files.
4. **Build errors**: If the site fails to build with "document ids do not exist" errors, run the validator to identify missing files.

### Error Messages

- **"Document ids do not exist"**: This error occurs when the sidebar references files that don't exist. Run the validator to identify missing files.
- **"Failed to extract sidebar references"**: This error occurs when the sidebar file cannot be parsed. Check the sidebar file for syntax errors.
- **"Error processing autogenerated directory"**: This error occurs when an autogenerated directory cannot be processed. Check if the directory exists and has the correct permissions.

## Conclusion

The enhanced vocabulary site scaffolding system ensures that all files referenced in the navigation sidebar exist, preventing build errors and providing a complete site structure for IFLA standards. By generating all necessary files with appropriate placeholder content, the system makes it easy to create new standards sites and maintain existing ones.