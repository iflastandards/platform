# Derived Roles Policy
# Defines how roles are derived from principal attributes based on the new architecture.
---
apiVersion: api.cerbos.dev/v1
derivedRoles:
  name: ifla_standards_roles
  definitions:
    # A global superadmin.
    - name: superadmin
      parentRoles: ["user"]
      condition:
        match:
          expr: '"superadmin" in P.roles'

    # Administrator for a specific namespace.
    - name: namespace_admin
      parentRoles: ["user"]
      condition:
        match:
          expr: 'P.attr.namespaces[R.attr.namespace] == "admin"'

    # Editor for a specific namespace. Admins are implicitly editors.
    - name: namespace_editor
      parentRoles: ["user"]
      condition:
        match:
          any:
            of:
              - expr: 'P.attr.namespaces[R.attr.namespace] == "admin"'
              - expr: 'P.attr.namespaces[R.attr.namespace] == "editor"'

    # Reviewer for a specific namespace. Admins and editors are implicitly reviewers.
    - name: namespace_reviewer
      parentRoles: ["user"]
      condition:
        match:
          any:
            of:
              - expr: 'P.attr.namespaces[R.attr.namespace] == "admin"'
              - expr: 'P.attr.namespaces[R.attr.namespace] == "editor"'
              - expr: 'P.attr.namespaces[R.attr.namespace] == "reviewer"'

    # Translator for a specific namespace.
    - name: namespace_translator
      parentRoles: ["user"]
      condition:
        match:
          expr: 'P.attr.namespaces[R.attr.namespace] == "translator"'
