# Current Scaffolding Plan

## Overview

This document outlines the current implementation of the vocabulary site scaffolding system, which has been enhanced to generate all necessary files referenced by the navigation sidebar. The system ensures that all files referenced in the sidebar exist, preventing "document ids do not exist" build errors.

## Implementation Components

### 1. Enhanced Page Template Generator

The `PageTemplateGenerator` class in `scripts/page-template-generator.ts` has been enhanced with new methods to generate individual element set pages, vocabulary pages, and documentation pages:

```typescript
class PageTemplateGenerator {
  // Existing methods
  async generateSitePageTemplates(namespace: string, config: SiteConfiguration): Promise<void>;
  private generateLandingPage(config: SiteConfiguration): PageTemplate;
  private generateElementSetsIndexPage(config: SiteConfiguration): PageTemplate;
  private generateVocabulariesIndexPage(config: SiteConfiguration): PageTemplate;
  
  // New methods
  private generateIndividualElementSetPages(config: SiteConfiguration): PageTemplate[];
  private generateIndividualVocabularyPages(config: SiteConfiguration): PageTemplate[];
  private generateDocumentationPages(config: SiteConfiguration): PageTemplate[];
  private generateToolsPages(config: SiteConfiguration): PageTemplate[];
}
```

The generator creates the following types of pages:

1. **Landing page** - `index.mdx` in the root docs directory
2. **Element sets index** - `elements/index.mdx`
3. **Individual element set pages** - `elements/{element-set-id}/index.mdx`
4. **Vocabularies index** - `vocabularies/index.mdx`
5. **Individual vocabulary pages** - `vocabularies/{vocabulary-id}.mdx`
6. **Documentation pages** - `introduction.mdx`, `examples.mdx`, `about.mdx`, etc.
7. **Tools & Resources pages** - `search.mdx`, `cross-set-browser.mdx`, etc. (for hierarchical navigation)

### 2. File Structure Validator

The file structure validator in `scripts/validate-sidebar-references.ts` ensures that all files referenced in the sidebar exist:

```typescript
// Main validation function
async function validateSidebarReferences(siteDir: string, sidebarPath: string): Promise<void> {
  // Extract references from sidebar
  const references = await extractSidebarReferencesFromFile(sidebarPath);
  
  // Expand autogenerated references
  const expandedReferences = await expandAutogeneratedReferences(siteDir, references);
  
  // Check if files exist
  const missingFiles = await checkFilesExist(siteDir, expandedReferences);
  
  // Generate report
  const report = generateMissingFilesReport(missingFiles);
}
```

The validator consists of three main components:

1. **Sidebar Reference Extractor** - Extracts document IDs from the sidebar configuration
2. **Autogenerated Reference Expander** - Expands autogenerated directory references to include all files
3. **File Existence Checker** - Checks if files exist for all document IDs

### 3. Main Generator Script

The main generator script has been updated to use the enhanced page template generator and add validation:

```typescript
async function main() {
  // Load site configurations
  const siteConfigs = JSON.parse(fs.readFileSync(configsPath, 'utf-8'));

  // Generate page templates
  const generator = new PageTemplateGenerator();
  await generator.generateAllPageTemplates(siteConfigs);

  // Validate file structure
  for (const namespace of Object.keys(siteConfigs)) {
    const siteDir = path.join('standards', namespace);
    const sidebarPath = path.join(siteDir, 'sidebars.ts');
    await validateSidebarReferences(siteDir, sidebarPath);
  }
}
```

## File Structure Details

### Element Set Pages

For each element set, the generator creates:

1. **Index page** - `elements/{element-set-id}/index.mdx`
2. **Subcategory pages** - For complex element sets like ISBD, creates subcategory index pages

Example element set index page:

```mdx
---
title: ISBD Manifestation
sidebar_position: 1
---

# ISBD Manifestation

Element set for describing manifestations in the ISBD standard.

This element set contains 156 elements.

## Overview

The ISBD Manifestation element set provides a structured way to describe ISBD resources.

## Elements

Elements will be listed here when imported.

## Languages

This element set is available in the following languages:
- English (en)
- French (fr)
- Spanish (es)
```

### Vocabulary Pages

For each vocabulary, the generator creates:

1. **Vocabulary page** - `vocabularies/{vocabulary-id}.mdx`
2. **Category index pages** - For categorized vocabularies, creates category index pages

Example vocabulary page:

```mdx
---
title: Content Forms
sidebar_position: 1
---

# Content Forms

Vocabulary of content forms in the ISBD standard.

This vocabulary contains 12 concepts.

## Concepts

Concepts will be listed here when imported.

## Languages

This vocabulary is available in the following languages:
- English (en)
- French (fr)
```

### Documentation Pages

The generator creates standard documentation pages:

1. **Introduction** - `introduction.mdx`
2. **Examples** - `examples.mdx`
3. **About** - `about.mdx`
4. **Assessment** - `assessment.mdx` (if needed)
5. **Glossary** - `glossary.mdx` (if needed)
6. **FAQ** - `faq.mdx` (if needed)

Example documentation page:

```mdx
---
title: Introduction
sidebar_position: 1000
---

# ISBD Introduction

Overview of ISBD principles, scope, and application guidelines.

## Purpose

The ISBD standard provides a framework for ISBD implementation.

## Key Concepts

Key concepts and principles of the ISBD standard.

## How to Use This Documentation

This documentation is organized into sections covering different aspects of the ISBD standard.

*This page is under development.*
```

### Tools & Resources Pages

For hierarchical navigation, the generator creates tools & resources pages:

1. **Search** - `search.mdx`
2. **Cross-Set Browser** - `cross-set-browser.mdx`
3. **Field Guide** - `field-guide.mdx`
4. **Export Tools** - `export-tools.mdx`
5. **Visualization** - `visualization.mdx`

Example tools page:

```mdx
---
title: Search
sidebar_position: 900
---

# ISBD Search

Advanced search functionality for ISBD elements and vocabularies.

import { SearchPage } from '@ifla/theme/components/SearchPage';

<SearchPage namespace="isbd" />

## Search Tips

- Use quotes for exact phrase matching: "title proper"
- Use wildcards for partial matching: catalog*
- Use boolean operators: AND, OR, NOT
- Filter by element set or vocabulary using the dropdown menus

*This page is under development.*
```

## Navigation Strategies

The system supports three navigation strategies:

1. **Simple** - Flat list of element sets and vocabularies
2. **Categorized** - Element sets and vocabularies grouped by category
3. **Hierarchical** - Complex nested structure with categories and subcategories

For hierarchical navigation, the system creates additional pages for tools & resources and organizes element sets and vocabularies into categories.

## Error Handling

The system includes robust error handling:

1. **Missing Directories** - Creates directories if they don't exist
2. **Existing Files** - Preserves existing files, doesn't overwrite
3. **Invalid References** - Logs warnings for sidebar references that can't be resolved

## Testing

The system includes comprehensive tests:

1. **Unit Tests** - Tests each template generation function
2. **Integration Tests** - Tests the complete file generation process
3. **Validation Tests** - Verifies that all sidebar references have corresponding files

## Usage Examples

### Generating a New Site

```bash
# Create a new site with the scaffold script
pnpm tsx scripts/scaffold-site.ts --siteKey=newsite --title="New Standard" --tagline="A new IFLA standard"

# Generate page templates for the site
pnpm tsx scripts/page-template-generator.ts --namespace=newsite
```

### Validating File Structure

```bash
# Validate a specific site
pnpm tsx scripts/validate-sidebar-references.ts standards/isbd

# Validate all sites
for site in standards/*; do
  if [ -d "$site" ]; then
    pnpm tsx scripts/validate-sidebar-references.ts "$site"
  fi
done
```

### Generating Missing Files

```bash
# Generate missing files for a specific site
pnpm tsx scripts/page-template-generator.ts --namespace=isbd --missing-only

# If command line options are not working, apply the fix
pnpm tsx scripts/fix-page-template-generator.ts
```

The fix script updates the page template generator to properly handle command line options. See [Vocabulary Site Scaffolding Fix](../docs/vocabulary-site-scaffolding-fix.md) for details.

## Future Enhancements

1. **Template Customization** - Allow customization of generated templates
2. **Content Import** - Integrate with content import system
3. **Automatic Updates** - Update files when navigation changes

## Conclusion

The enhanced vocabulary site scaffolding system ensures that all files referenced in the navigation sidebar exist, preventing build errors and providing a complete site structure for IFLA standards. By generating all necessary files with appropriate placeholder content, the system makes it easy to create new standards sites and maintain existing ones.