# Design: Multi-Element Set Architecture for IFLA Standards

## Problem Statement

The current system assumes one element set per Docusaurus site, but the reality is more complex:
- **ISBD namespace**: 2 element sets (ISBD, ISBD Unconstrained) + 7 concept schemes
- **ISBD-LRM namespace**: 9 element sets (ISBDM, ISBDW, ISBDE, etc.) + concept schemes
- **UNIMARC namespace**: ~24 element sets organized by field groups + many concept schemes

## Recommended Architecture: Enhanced One Site Per Namespace

Keep one Docusaurus site per namespace but enhance to handle multiple element sets.

### Site Structure

```
/standards/isbd/
├── docs/
│   ├── index.mdx                    # Namespace overview
│   ├── elements/                    # Element Sets section
│   │   ├── index.mdx               # Element sets overview
│   │   ├── isbd/                   # ISBD element set
│   │   │   ├── index.mdx          # ISBD overview
│   │   │   ├── statements/        # Elements by category
│   │   │   ├── notes/
│   │   │   └── attributes/
│   │   └── unconstrained/          # ISBD Unconstrained element set
│   │       ├── index.mdx          # Unconstrained overview
│   │       └── elements/          # All unconstrained elements
│   └── vocabularies/               # Concept Schemes section
│       ├── index.mdx              # Vocabularies overview
│       ├── content-form/
│       ├── media-type/
│       └── ...
```

### Navigation Design

#### 1. Enhanced Sidebar Structure

```typescript
// sidebars.ts for multi-element namespace
const sidebars = {
  docs: [
    {
      type: 'doc',
      id: 'index',
      label: 'ISBD Overview'
    },
    {
      type: 'category',
      label: 'Element Sets',
      link: {
        type: 'doc',
        id: 'elements/index'
      },
      items: [
        {
          type: 'category',
          label: 'ISBD Elements',
          link: {
            type: 'doc',
            id: 'elements/isbd/index'
          },
          items: [
            {
              type: 'category',
              label: 'Statements',
              link: { type: 'doc', id: 'elements/isbd/statements/index' },
              items: [{ type: 'autogenerated', dirName: 'elements/isbd/statements' }]
            },
            // ... other categories
          ]
        },
        {
          type: 'category',
          label: 'ISBD Unconstrained',
          link: {
            type: 'doc',
            id: 'elements/unconstrained/index'
          },
          items: [{ type: 'autogenerated', dirName: 'elements/unconstrained' }]
        }
      ]
    },
    {
      type: 'category',
      label: 'Vocabularies',
      link: {
        type: 'doc',
        id: 'vocabularies/index'
      },
      items: [
        {
          type: 'category',
          label: 'Content Form',
          link: { type: 'doc', id: 'vocabularies/content-form/index' },
          items: [{ type: 'autogenerated', dirName: 'vocabularies/content-form' }]
        },
        // ... other vocabularies
      ]
    }
  ]
};
```

#### 2. Enhanced Navbar with Element Set Dropdown

```typescript
// navbar.ts
import type { Navbar } from '@docusaurus/theme-common';

const navbar: Navbar = {
  title: 'ISBD',
  logo: {
    alt: 'IFLA Logo',
    src: 'img/logo.svg',
  },
  items: [
    {
      type: 'dropdown',
      label: 'Element Sets',
      position: 'left',
      items: [
        {
          label: 'ISBD Elements',
          to: '/docs/elements/isbd',
        },
        {
          label: 'ISBD Unconstrained',
          to: '/docs/elements/unconstrained',
        },
      ],
    },
    {
      type: 'dropdown',
      label: 'Vocabularies',
      position: 'left',
      items: [
        {
          label: 'Content Form',
          to: '/docs/vocabularies/content-form',
        },
        {
          label: 'Media Type',
          to: '/docs/vocabularies/media-type',
        },
        // ... more vocabularies
      ],
    },
    {
      to: '/docs',
      label: 'Documentation',
      position: 'left',
    },
  ],
};
```

### Component Enhancements

#### 1. Element Set Overview Component

```tsx
// src/components/ElementSetOverview.tsx
import React from 'react';
import Link from '@docusaurus/Link';
import styles from './ElementSetOverview.module.css';

interface ElementSet {
  id: string;
  title: string;
  description: string;
  elementCount: number;
  lastUpdated: string;
  path: string;
}

export function ElementSetOverview({ elementSets }: { elementSets: ElementSet[] }) {
  return (
    <div className={styles.grid}>
      {elementSets.map((set) => (
        <div key={set.id} className={styles.card}>
          <h3>{set.title}</h3>
          <p>{set.description}</p>
          <div className={styles.stats}>
            <span>{set.elementCount} elements</span>
            <span>Updated: {set.lastUpdated}</span>
          </div>
          <Link to={set.path} className="button button--primary">
            Browse Elements →
          </Link>
        </div>
      ))}
    </div>
  );
}
```

#### 2. Cross-Element Set Search

```tsx
// src/components/CrossSetSearch.tsx
import React, { useState } from 'react';
import { usePluginData } from '@docusaurus/useGlobalData';

export function CrossSetSearch() {
  const [query, setQuery] = useState('');
  const [selectedSets, setSelectedSets] = useState<string[]>(['all']);
  
  const elementSets = usePluginData('element-sets-plugin');
  
  return (
    <div className="cross-set-search">
      <input
        type="text"
        placeholder="Search across element sets..."
        value={query}
        onChange={(e) => setQuery(e.target.value)}
      />
      <div className="filter-chips">
        <label>
          <input
            type="checkbox"
            checked={selectedSets.includes('all')}
            onChange={() => setSelectedSets(['all'])}
          />
          All Element Sets
        </label>
        {elementSets.map((set) => (
          <label key={set.id}>
            <input
              type="checkbox"
              checked={selectedSets.includes(set.id)}
              onChange={(e) => {
                if (e.target.checked) {
                  setSelectedSets([...selectedSets.filter(s => s !== 'all'), set.id]);
                } else {
                  setSelectedSets(selectedSets.filter(s => s !== set.id));
                }
              }}
            />
            {set.title}
          </label>
        ))}
      </div>
      {/* Search results would go here */}
    </div>
  );
}
```

### Page Templates

#### 1. Namespace Overview Page

```mdx
<!-- docs/index.mdx -->
# ISBD - International Standard Bibliographic Description

import { ElementSetOverview } from '@site/src/components/ElementSetOverview';
import { VocabularyOverview } from '@site/src/components/VocabularyOverview';

The ISBD namespace contains multiple element sets and vocabularies for bibliographic description.

## Element Sets

<ElementSetOverview elementSets={[
  {
    id: 'isbd',
    title: 'ISBD Elements',
    description: 'Core ISBD elements with domain and range constraints',
    elementCount: 185,
    lastUpdated: '2025-01-15',
    path: '/docs/elements/isbd'
  },
  {
    id: 'unconstrained',
    title: 'ISBD Unconstrained',
    description: 'ISBD elements without domain/range constraints for flexibility',
    elementCount: 185,
    lastUpdated: '2025-01-15',
    path: '/docs/elements/unconstrained'
  }
]} />

## Vocabularies

<VocabularyOverview />
```

#### 2. Element Set Index Page

```mdx
<!-- docs/elements/isbd/index.mdx -->
# ISBD Elements

import { ElementBrowser } from '@site/src/components/ElementBrowser';
import { ElementStats } from '@site/src/components/ElementStats';

This element set contains the core ISBD elements with full semantic constraints.

<ElementStats elementSetId="isbd" />

## Browse by Category

- [Statements](/docs/elements/isbd/statements) - Title, edition, publication statements
- [Notes](/docs/elements/isbd/notes) - Descriptive and explanatory notes
- [Attributes](/docs/elements/isbd/attributes) - Physical and content attributes
- [Relationships](/docs/elements/isbd/relationships) - Links between resources

## Search This Element Set

<ElementBrowser elementSetId="isbd" />
```

### Data Architecture

#### 1. Enhanced Site Configuration

```json
// site-config.json
{
  "namespace": "isbd",
  "title": "ISBD - International Standard Bibliographic Description",
  "elementSets": [
    {
      "id": "isbd",
      "title": "ISBD Elements",
      "prefix": "isbd",
      "baseIRI": "http://iflastandards.info/ns/isbd/elements/",
      "categories": ["statements", "notes", "attributes", "relationships"]
    },
    {
      "id": "unconstrained",
      "title": "ISBD Unconstrained",
      "prefix": "isbdu",
      "baseIRI": "http://iflastandards.info/ns/isbd/unc/elements/",
      "categories": ["elements"]
    }
  ],
  "vocabularies": [
    {
      "id": "content-form",
      "title": "Content Form",
      "baseIRI": "http://iflastandards.info/ns/isbd/terms/contentform/"
    },
    // ... more vocabularies
  ]
}
```

#### 2. Routing Structure

```typescript
// docusaurus.config.ts additions
{
  plugins: [
    [
      '@docusaurus/plugin-content-docs',
      {
        routeBasePath: 'docs',
        // Custom plugin to handle element set routing
        beforeDefaultRemarkPlugins: [
          [elementSetRoutingPlugin, { siteConfig }]
        ],
      },
    ],
    // Custom plugin for element set data
    ['./plugins/element-sets-plugin', { siteConfig }],
  ],
}
```

### Import Workflow Integration

The adopt/import workflow needs to handle multiple element sets:

1. **Spreadsheet Analysis**: Detect which element set each worksheet belongs to
2. **Namespace Assignment**: All element sets in a spreadsheet must belong to the same namespace
3. **Path Generation**: Generate correct paths based on element set structure
4. **Cross-References**: Handle references between element sets in the same namespace

### Benefits

1. **Scalability**: Can handle UNIMARC's 24 element sets
2. **Discoverability**: Users can browse by element set or search across all
3. **Relationships**: Shared vocabularies have a clear home
4. **Maintainability**: One repo/site per namespace is manageable
5. **Navigation**: Clear hierarchy and multiple navigation paths
6. **Future-Proof**: Can add new element sets without restructuring

### Implementation Priority

1. **Phase 1**: Update site scaffolding to support multiple element sets
2. **Phase 2**: Create navigation components (ElementSetOverview, CrossSetSearch)
3. **Phase 3**: Update import workflow to handle element set assignment
4. **Phase 4**: Migrate existing ISBD site to new structure
5. **Phase 5**: Implement UNIMARC with its 24 element sets as proof of concept

This architecture provides a clean, scalable solution that maintains the benefits of one site per namespace while properly handling the complexity of multiple element sets.