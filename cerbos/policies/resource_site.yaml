# Site Resource Policy
# Defines permissions for site-level operations (individual standards sites)
---
apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: "default"
  resource: "site"
  importDerivedRoles:
    - ifla_standards_roles
  rules:
    # System administrators can do everything
    - actions: ["*"]
      effect: EFFECT_ALLOW
      roles: ["system-admin", "ifla-admin"]
      
    # Review group administrators can manage sites in their review group
    - actions: ["view", "edit", "manage", "delete", "configure", "manage_users"]
      effect: EFFECT_ALLOW
      derivedRoles: ["rg_admin"]
      
    # Site administrators can manage their specific site
    - actions: ["view", "edit", "manage", "configure", "manage_users"]
      effect: EFFECT_ALLOW
      derivedRoles: ["site_admin"]
      
    # Review group editors can edit any site in their review group
    - actions: ["view", "edit", "create", "update"]
      effect: EFFECT_ALLOW
      derivedRoles: ["rg_editor"]
      
    # Site editors can edit their specific site
    - actions: ["view", "edit", "create", "update"]
      effect: EFFECT_ALLOW
      derivedRoles: ["site_editor"]
      
    # Review group reviewers can review sites in their review group
    - actions: ["view", "review", "approve", "reject", "comment"]
      effect: EFFECT_ALLOW
      derivedRoles: ["rg_reviewer"]
      
    # Review group translators can translate any site in their review group
    - actions: ["view", "translate", "edit_translation"]
      effect: EFFECT_ALLOW
      derivedRoles: ["rg_translator"]
      
    # Site translators can translate their specific site
    - actions: ["view", "translate", "edit_translation"]
      effect: EFFECT_ALLOW
      derivedRoles: ["site_translator"]
      
    # Review group contributors can contribute to any site in their review group
    - actions: ["view", "contribute", "propose", "comment"]
      effect: EFFECT_ALLOW
      derivedRoles: ["rg_contributor"]
      
    # Site contributors can contribute to their specific site
    - actions: ["view", "contribute", "propose", "comment"]
      effect: EFFECT_ALLOW
      derivedRoles: ["site_contributor"]
      
    # Anyone can view public sites
    - actions: ["view"]
      effect: EFFECT_ALLOW
      roles: ["*"]
      condition:
        match:
          expr: R.attr.visibility == "public"
          
  schemas:
    principalSchema:
      ref: cerbos:///principal.json
    resourceSchema:
      ref: cerbos:///site.json